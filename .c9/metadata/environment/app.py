{"filter":false,"title":"app.py","tooltip":"/app.py","undoManager":{"mark":100,"position":100,"stack":[[{"start":{"row":41,"column":21},"end":{"row":41,"column":22},"action":"insert","lines":["d"],"id":1581},{"start":{"row":41,"column":22},"end":{"row":41,"column":23},"action":"insert","lines":["i"]},{"start":{"row":41,"column":23},"end":{"row":41,"column":24},"action":"insert","lines":["r"]},{"start":{"row":41,"column":24},"end":{"row":41,"column":25},"action":"insert","lines":["e"]},{"start":{"row":41,"column":25},"end":{"row":41,"column":26},"action":"insert","lines":["c"]},{"start":{"row":41,"column":26},"end":{"row":41,"column":27},"action":"insert","lines":["t"]}],[{"start":{"row":41,"column":27},"end":{"row":41,"column":29},"action":"insert","lines":["()"],"id":1582}],[{"start":{"row":41,"column":28},"end":{"row":41,"column":29},"action":"insert","lines":["u"],"id":1583},{"start":{"row":41,"column":29},"end":{"row":41,"column":30},"action":"insert","lines":["r"]},{"start":{"row":41,"column":30},"end":{"row":41,"column":31},"action":"insert","lines":["l"]}],[{"start":{"row":41,"column":31},"end":{"row":41,"column":32},"action":"insert","lines":["_"],"id":1584},{"start":{"row":41,"column":32},"end":{"row":41,"column":33},"action":"insert","lines":["_"]}],[{"start":{"row":41,"column":32},"end":{"row":41,"column":33},"action":"remove","lines":["_"],"id":1585}],[{"start":{"row":41,"column":32},"end":{"row":41,"column":33},"action":"insert","lines":["f"],"id":1586},{"start":{"row":41,"column":33},"end":{"row":41,"column":34},"action":"insert","lines":["o"]},{"start":{"row":41,"column":34},"end":{"row":41,"column":35},"action":"insert","lines":["r"]}],[{"start":{"row":41,"column":35},"end":{"row":41,"column":36},"action":"insert","lines":[" "],"id":1587}],[{"start":{"row":41,"column":35},"end":{"row":41,"column":36},"action":"remove","lines":[" "],"id":1588}],[{"start":{"row":41,"column":35},"end":{"row":41,"column":37},"action":"insert","lines":["()"],"id":1589}],[{"start":{"row":41,"column":36},"end":{"row":41,"column":38},"action":"insert","lines":["''"],"id":1590}],[{"start":{"row":41,"column":37},"end":{"row":41,"column":38},"action":"insert","lines":["i"],"id":1591},{"start":{"row":41,"column":38},"end":{"row":41,"column":39},"action":"insert","lines":["n"]},{"start":{"row":41,"column":39},"end":{"row":41,"column":40},"action":"insert","lines":["d"]},{"start":{"row":41,"column":40},"end":{"row":41,"column":41},"action":"insert","lines":["e"]},{"start":{"row":41,"column":41},"end":{"row":41,"column":42},"action":"insert","lines":["x"]}],[{"start":{"row":41,"column":45},"end":{"row":42,"column":0},"action":"insert","lines":["",""],"id":1592},{"start":{"row":42,"column":0},"end":{"row":42,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":42,"column":8},"end":{"row":42,"column":9},"action":"insert","lines":["r"],"id":1593},{"start":{"row":42,"column":9},"end":{"row":42,"column":10},"action":"insert","lines":["e"]},{"start":{"row":42,"column":10},"end":{"row":42,"column":11},"action":"insert","lines":["t"]},{"start":{"row":42,"column":11},"end":{"row":42,"column":12},"action":"insert","lines":["u"]},{"start":{"row":42,"column":12},"end":{"row":42,"column":13},"action":"insert","lines":["e"]},{"start":{"row":42,"column":13},"end":{"row":42,"column":14},"action":"insert","lines":["n"]}],[{"start":{"row":42,"column":14},"end":{"row":42,"column":15},"action":"insert","lines":[" "],"id":1594}],[{"start":{"row":42,"column":14},"end":{"row":42,"column":15},"action":"remove","lines":[" "],"id":1595},{"start":{"row":42,"column":13},"end":{"row":42,"column":14},"action":"remove","lines":["n"]},{"start":{"row":42,"column":12},"end":{"row":42,"column":13},"action":"remove","lines":["e"]}],[{"start":{"row":42,"column":12},"end":{"row":42,"column":13},"action":"insert","lines":["r"],"id":1596},{"start":{"row":42,"column":13},"end":{"row":42,"column":14},"action":"insert","lines":["n"]}],[{"start":{"row":42,"column":14},"end":{"row":42,"column":15},"action":"insert","lines":[" "],"id":1597}],[{"start":{"row":42,"column":15},"end":{"row":42,"column":17},"action":"insert","lines":["''"],"id":1598}],[{"start":{"row":42,"column":16},"end":{"row":42,"column":17},"action":"insert","lines":["T"],"id":1599},{"start":{"row":42,"column":17},"end":{"row":42,"column":18},"action":"insert","lines":["h"]},{"start":{"row":42,"column":18},"end":{"row":42,"column":19},"action":"insert","lines":["a"]},{"start":{"row":42,"column":19},"end":{"row":42,"column":20},"action":"insert","lines":["t"]}],[{"start":{"row":42,"column":20},"end":{"row":42,"column":21},"action":"insert","lines":[" "],"id":1600},{"start":{"row":42,"column":21},"end":{"row":42,"column":22},"action":"insert","lines":["u"]},{"start":{"row":42,"column":22},"end":{"row":42,"column":23},"action":"insert","lines":["s"]},{"start":{"row":42,"column":23},"end":{"row":42,"column":24},"action":"insert","lines":["e"]},{"start":{"row":42,"column":24},"end":{"row":42,"column":25},"action":"insert","lines":["r"]},{"start":{"row":42,"column":25},"end":{"row":42,"column":26},"action":"insert","lines":["n"]},{"start":{"row":42,"column":26},"end":{"row":42,"column":27},"action":"insert","lines":["a"]}],[{"start":{"row":42,"column":27},"end":{"row":42,"column":28},"action":"insert","lines":["m"],"id":1601},{"start":{"row":42,"column":28},"end":{"row":42,"column":29},"action":"insert","lines":["e"]}],[{"start":{"row":42,"column":29},"end":{"row":42,"column":30},"action":"insert","lines":[" "],"id":1602},{"start":{"row":42,"column":30},"end":{"row":42,"column":31},"action":"insert","lines":["i"]},{"start":{"row":42,"column":31},"end":{"row":42,"column":32},"action":"insert","lines":["s"]}],[{"start":{"row":42,"column":32},"end":{"row":42,"column":33},"action":"insert","lines":[" "],"id":1603}],[{"start":{"row":42,"column":32},"end":{"row":42,"column":33},"action":"remove","lines":[" "],"id":1604},{"start":{"row":42,"column":31},"end":{"row":42,"column":32},"action":"remove","lines":["s"]},{"start":{"row":42,"column":30},"end":{"row":42,"column":31},"action":"remove","lines":["i"]}],[{"start":{"row":42,"column":30},"end":{"row":42,"column":31},"action":"insert","lines":["a"],"id":1605},{"start":{"row":42,"column":31},"end":{"row":42,"column":32},"action":"insert","lines":["l"]},{"start":{"row":42,"column":32},"end":{"row":42,"column":33},"action":"insert","lines":["r"]},{"start":{"row":42,"column":33},"end":{"row":42,"column":34},"action":"insert","lines":["e"]},{"start":{"row":42,"column":34},"end":{"row":42,"column":35},"action":"insert","lines":["a"]},{"start":{"row":42,"column":35},"end":{"row":42,"column":36},"action":"insert","lines":["d"]},{"start":{"row":42,"column":36},"end":{"row":42,"column":37},"action":"insert","lines":["y"]}],[{"start":{"row":42,"column":37},"end":{"row":42,"column":38},"action":"insert","lines":[" "],"id":1606},{"start":{"row":42,"column":38},"end":{"row":42,"column":39},"action":"insert","lines":["e"]},{"start":{"row":42,"column":39},"end":{"row":42,"column":40},"action":"insert","lines":["x"]},{"start":{"row":42,"column":40},"end":{"row":42,"column":41},"action":"insert","lines":["i"]},{"start":{"row":42,"column":41},"end":{"row":42,"column":42},"action":"insert","lines":["s"]},{"start":{"row":42,"column":42},"end":{"row":42,"column":43},"action":"insert","lines":["t"]},{"start":{"row":42,"column":43},"end":{"row":42,"column":44},"action":"insert","lines":["s"]}],[{"start":{"row":42,"column":44},"end":{"row":42,"column":45},"action":"insert","lines":["!"],"id":1607}],[{"start":{"row":41,"column":45},"end":{"row":42,"column":0},"action":"insert","lines":["",""],"id":1608},{"start":{"row":42,"column":0},"end":{"row":42,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":28,"column":45},"end":{"row":29,"column":0},"action":"insert","lines":["",""],"id":1609},{"start":{"row":29,"column":0},"end":{"row":29,"column":12},"action":"insert","lines":["            "]}],[{"start":{"row":44,"column":48},"end":{"row":44,"column":50},"action":"remove","lines":["  "],"id":1610},{"start":{"row":44,"column":48},"end":{"row":45,"column":0},"action":"insert","lines":["",""]},{"start":{"row":45,"column":0},"end":{"row":45,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":45,"column":4},"end":{"row":45,"column":5},"action":"insert","lines":["r"],"id":1611},{"start":{"row":45,"column":5},"end":{"row":45,"column":6},"action":"insert","lines":["e"]},{"start":{"row":45,"column":6},"end":{"row":45,"column":7},"action":"insert","lines":["t"]},{"start":{"row":45,"column":7},"end":{"row":45,"column":8},"action":"insert","lines":["u"]},{"start":{"row":45,"column":8},"end":{"row":45,"column":9},"action":"insert","lines":["r"]},{"start":{"row":45,"column":9},"end":{"row":45,"column":10},"action":"insert","lines":["n"]}],[{"start":{"row":45,"column":10},"end":{"row":45,"column":11},"action":"insert","lines":[" "],"id":1612},{"start":{"row":45,"column":11},"end":{"row":45,"column":12},"action":"insert","lines":["r"]},{"start":{"row":45,"column":12},"end":{"row":45,"column":13},"action":"insert","lines":["e"]},{"start":{"row":45,"column":13},"end":{"row":45,"column":14},"action":"insert","lines":["n"]},{"start":{"row":45,"column":14},"end":{"row":45,"column":15},"action":"insert","lines":["d"]},{"start":{"row":45,"column":15},"end":{"row":45,"column":16},"action":"insert","lines":["e"]},{"start":{"row":45,"column":16},"end":{"row":45,"column":17},"action":"insert","lines":["r"]},{"start":{"row":45,"column":17},"end":{"row":45,"column":18},"action":"insert","lines":["_"]}],[{"start":{"row":45,"column":18},"end":{"row":45,"column":19},"action":"insert","lines":["t"],"id":1613},{"start":{"row":45,"column":19},"end":{"row":45,"column":20},"action":"insert","lines":["e"]},{"start":{"row":45,"column":20},"end":{"row":45,"column":21},"action":"insert","lines":["m"]},{"start":{"row":45,"column":21},"end":{"row":45,"column":22},"action":"insert","lines":["p"]},{"start":{"row":45,"column":22},"end":{"row":45,"column":23},"action":"insert","lines":["l"]},{"start":{"row":45,"column":23},"end":{"row":45,"column":24},"action":"insert","lines":["a"]},{"start":{"row":45,"column":24},"end":{"row":45,"column":25},"action":"insert","lines":["t"]},{"start":{"row":45,"column":25},"end":{"row":45,"column":26},"action":"insert","lines":["e"]}],[{"start":{"row":45,"column":26},"end":{"row":45,"column":28},"action":"insert","lines":["()"],"id":1614}],[{"start":{"row":45,"column":27},"end":{"row":45,"column":29},"action":"insert","lines":["''"],"id":1615}],[{"start":{"row":45,"column":28},"end":{"row":45,"column":29},"action":"insert","lines":["r"],"id":1616},{"start":{"row":45,"column":29},"end":{"row":45,"column":30},"action":"insert","lines":["e"]},{"start":{"row":45,"column":30},"end":{"row":45,"column":31},"action":"insert","lines":["g"]},{"start":{"row":45,"column":31},"end":{"row":45,"column":32},"action":"insert","lines":["i"]},{"start":{"row":45,"column":32},"end":{"row":45,"column":33},"action":"insert","lines":["s"]},{"start":{"row":45,"column":33},"end":{"row":45,"column":34},"action":"insert","lines":["t"]},{"start":{"row":45,"column":34},"end":{"row":45,"column":35},"action":"insert","lines":["e"]},{"start":{"row":45,"column":35},"end":{"row":45,"column":36},"action":"insert","lines":["r"]}],[{"start":{"row":45,"column":36},"end":{"row":45,"column":37},"action":"insert","lines":["."],"id":1617},{"start":{"row":45,"column":37},"end":{"row":45,"column":38},"action":"insert","lines":["h"]},{"start":{"row":45,"column":38},"end":{"row":45,"column":39},"action":"insert","lines":["t"]},{"start":{"row":45,"column":39},"end":{"row":45,"column":40},"action":"insert","lines":["m"]},{"start":{"row":45,"column":40},"end":{"row":45,"column":41},"action":"insert","lines":["l"]}],[{"start":{"row":44,"column":48},"end":{"row":45,"column":0},"action":"insert","lines":["",""],"id":1618},{"start":{"row":45,"column":0},"end":{"row":45,"column":8},"action":"insert","lines":["        "]}],[{"start":{"row":28,"column":42},"end":{"row":28,"column":43},"action":"insert","lines":["."],"id":1619},{"start":{"row":28,"column":43},"end":{"row":28,"column":44},"action":"insert","lines":["h"]},{"start":{"row":28,"column":44},"end":{"row":28,"column":45},"action":"insert","lines":["t"]},{"start":{"row":28,"column":45},"end":{"row":28,"column":46},"action":"insert","lines":["m"]},{"start":{"row":28,"column":46},"end":{"row":28,"column":47},"action":"insert","lines":["l"]}],[{"start":{"row":42,"column":42},"end":{"row":42,"column":43},"action":"insert","lines":["."],"id":1620},{"start":{"row":42,"column":43},"end":{"row":42,"column":44},"action":"insert","lines":["h"]},{"start":{"row":42,"column":44},"end":{"row":42,"column":45},"action":"insert","lines":["t"]},{"start":{"row":42,"column":45},"end":{"row":42,"column":46},"action":"insert","lines":["m"]},{"start":{"row":42,"column":46},"end":{"row":42,"column":47},"action":"insert","lines":["l"]}],[{"start":{"row":78,"column":48},"end":{"row":78,"column":49},"action":"insert","lines":["s"],"id":1621}],[{"start":{"row":78,"column":48},"end":{"row":78,"column":49},"action":"remove","lines":["s"],"id":1622}],[{"start":{"row":20,"column":0},"end":{"row":46,"column":44},"action":"remove","lines":["@app.route('/login', methods=['POST'])    ","def  login():","    users = mongo.db.users","    login_user = users.find_one({'username' : request.form['username']})","    ","    if login_user:","        if bcrypt.hashpw(request.form['pass'].encode('utf-8'), login_user['password'].encode('utf-8')) == login_user['password'].encode('utf-8'):","            session['username'] = request.form['username']","            return redirect(url_for('index.html'))","            ","    return 'Invalid username/password combination'","","@app.route('/register', methods=['POST', 'GET']) ","def register():","    if request.method == 'POST':","        users = mongo.db.users","        existing_user = users.find_one({'username' : request.form['username']})","        ","        if existing_user is None:","            hashpass = bcrypt.hashpw(request.form['password'].encode('utf-8'), bcrypt.gensalt())","            users.insert({'username' : request.form['username'], 'password' : hashpass})","            session['username'] = request.form['username']","            return redirect(url_for('index.html'))","            ","        return 'That username already exists!'  ","        ","    return render_template('register.html') "],"id":1623}],[{"start":{"row":6,"column":12},"end":{"row":6,"column":13},"action":"remove","lines":["t"],"id":1624},{"start":{"row":6,"column":11},"end":{"row":6,"column":12},"action":"remove","lines":["p"]},{"start":{"row":6,"column":10},"end":{"row":6,"column":11},"action":"remove","lines":["y"]},{"start":{"row":6,"column":9},"end":{"row":6,"column":10},"action":"remove","lines":["r"]},{"start":{"row":6,"column":8},"end":{"row":6,"column":9},"action":"remove","lines":["c"]},{"start":{"row":6,"column":7},"end":{"row":6,"column":8},"action":"remove","lines":["b"]},{"start":{"row":6,"column":6},"end":{"row":6,"column":7},"action":"remove","lines":[" "]},{"start":{"row":6,"column":5},"end":{"row":6,"column":6},"action":"remove","lines":["t"]},{"start":{"row":6,"column":4},"end":{"row":6,"column":5},"action":"remove","lines":["r"]},{"start":{"row":6,"column":3},"end":{"row":6,"column":4},"action":"remove","lines":["o"]},{"start":{"row":6,"column":2},"end":{"row":6,"column":3},"action":"remove","lines":["p"]},{"start":{"row":6,"column":1},"end":{"row":6,"column":2},"action":"remove","lines":["m"]}],[{"start":{"row":6,"column":0},"end":{"row":6,"column":1},"action":"remove","lines":["i"],"id":1625},{"start":{"row":5,"column":27},"end":{"row":6,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":19,"column":2},"end":{"row":19,"column":3},"action":"remove","lines":[" "],"id":1626},{"start":{"row":19,"column":1},"end":{"row":19,"column":2},"action":"remove","lines":[" "]},{"start":{"row":19,"column":0},"end":{"row":19,"column":1},"action":"remove","lines":[" "]},{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":18,"column":0},"end":{"row":19,"column":0},"action":"insert","lines":["",""],"id":1627}],[{"start":{"row":5,"column":27},"end":{"row":6,"column":0},"action":"insert","lines":["",""],"id":1628}],[{"start":{"row":6,"column":0},"end":{"row":7,"column":0},"action":"insert","lines":["from werkzeug.security import generate_password_hash, check_password_hash",""],"id":1629}],[{"start":{"row":21,"column":0},"end":{"row":34,"column":0},"action":"insert","lines":["# Login","@app.route('/login', methods=['GET'])","def login():","\t# Check if user is not logged in already","\tif 'user' in session:","\t\tuser_in_db = users_collection.find_one({\"username\": session['user']})","\t\tif user_in_db:","\t\t\t# If so redirect user to his profile","\t\t\tflash(\"You are logged in already!\")","\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\telse:","\t\t# Render the page for user to be able to log in","\t\treturn render_template(\"login.html\")",""],"id":1630}],[{"start":{"row":34,"column":0},"end":{"row":58,"column":0},"action":"insert","lines":["# Check user login details from login form","@app.route('/user_auth', methods=['POST'])","def user_auth():","\tform = request.form.to_dict()","\tuser_in_db = users_collection.find_one({\"username\": form['username']})","\t# Check for user in database","\tif user_in_db:","\t\t# If passwords match (hashed / real password)","\t\tif check_password_hash(user_in_db['password'], form['user_password']):","\t\t\t# Log user in (add to session)","\t\t\tsession['user'] = form['username']","\t\t\t# If the user is admin redirect him to admin area","\t\t\tif session['user'] == \"admin\":","\t\t\t\treturn redirect(url_for('admin'))","\t\t\telse:","\t\t\t\tflash(\"You were logged in!\")","\t\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\t\t\t","\t\telse:","\t\t\tflash(\"Wrong password or user name!\")","\t\t\treturn redirect(url_for('login'))","\telse:","\t\tflash(\"You must be registered!\")","\t\treturn redirect(url_for('register'))",""],"id":1631}],[{"start":{"row":58,"column":0},"end":{"row":101,"column":0},"action":"insert","lines":["# Sign up","@app.route('/register', methods=['GET', 'POST'])","def register():","\t# Check if user is not logged in already","\tif 'user' in session:","\t\tflash('You are already sign in!')","\t\treturn redirect(url_for('index'))","\tif request.method == 'POST':","\t\tform = request.form.to_dict()","\t\t# Check if the password and password1 actualy match ","\t\tif form['user_password'] == form['user_password1']:","\t\t\t# If so try to find the user in db","\t\t\tuser = users_collection.find_one({\"username\" : form['username']})","\t\t\tif user:","\t\t\t\tflash(f\"{form['username']} already exists!\")","\t\t\t\treturn redirect(url_for('register'))","\t\t\t# If user does not exist register new user","\t\t\telse:\t\t\t\t","\t\t\t\t# Hash password","\t\t\t\thash_pass = generate_password_hash(form['user_password'])","\t\t\t\t#Create new user with hashed password","\t\t\t\tusers_collection.insert_one(","\t\t\t\t\t{","\t\t\t\t\t\t'username': form['username'],","\t\t\t\t\t\t'email': form['email'],","\t\t\t\t\t\t'password': hash_pass","\t\t\t\t\t}","\t\t\t\t)","\t\t\t\t# Check if user is actualy saved","\t\t\t\tuser_in_db = users_collection.find_one({\"username\": form['username']})","\t\t\t\tif user_in_db:","\t\t\t\t\t# Log user in (add to session)","\t\t\t\t\tsession['user'] = user_in_db['username']","\t\t\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\t\t\t\telse:","\t\t\t\t\tflash(\"There was a problem savaing your profile\")","\t\t\t\t\treturn redirect(url_for('register'))","","\t\telse:","\t\t\tflash(\"Passwords dont match!\")","\t\t\treturn redirect(url_for('register'))","\t\t","\treturn render_template(\"register.html\")",""],"id":1632}],[{"start":{"row":101,"column":0},"end":{"row":108,"column":0},"action":"insert","lines":["# Log out","@app.route('/logout')","def logout():","\t# Clear the session","\tsession.clear()","\tflash('You were logged out!')","\treturn redirect(url_for('index'))",""],"id":1633}],[{"start":{"row":108,"column":0},"end":{"row":108,"column":1},"action":"insert","lines":["v"],"id":1634}],[{"start":{"row":108,"column":0},"end":{"row":108,"column":1},"action":"remove","lines":["v"],"id":1635}],[{"start":{"row":108,"column":0},"end":{"row":118,"column":35},"action":"insert","lines":["# Profile Page","@app.route('/profile/<user>')","def profile(user): ","\t# Check if user is logged in","\tif 'user' in session:","\t\t# If so get the user and pass him to template for now","\t\tuser_in_db = users_collection.find_one({\"username\": user})","\t\treturn render_template('profile.html', user=user_in_db)","\telse:","\t\tflash(\"You must be logged in!\")","\t\treturn redirect(url_for('index'))"],"id":1636}],[{"start":{"row":107,"column":34},"end":{"row":108,"column":0},"action":"insert","lines":["",""],"id":1637},{"start":{"row":108,"column":0},"end":{"row":108,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":100,"column":40},"end":{"row":101,"column":0},"action":"insert","lines":["",""],"id":1638},{"start":{"row":101,"column":0},"end":{"row":101,"column":1},"action":"insert","lines":["\t"]}],[{"start":{"row":57,"column":38},"end":{"row":58,"column":0},"action":"insert","lines":["",""],"id":1639},{"start":{"row":58,"column":0},"end":{"row":58,"column":2},"action":"insert","lines":["\t\t"]}],[{"start":{"row":33,"column":38},"end":{"row":34,"column":0},"action":"insert","lines":["",""],"id":1640},{"start":{"row":34,"column":0},"end":{"row":34,"column":2},"action":"insert","lines":["\t\t"]}],[{"start":{"row":26,"column":6},"end":{"row":26,"column":7},"action":"insert","lines":["s"],"id":1641}],[{"start":{"row":26,"column":6},"end":{"row":26,"column":7},"action":"remove","lines":["s"],"id":1642}],[{"start":{"row":26,"column":15},"end":{"row":26,"column":31},"action":"remove","lines":["users_collection"],"id":1643},{"start":{"row":26,"column":15},"end":{"row":26,"column":16},"action":"insert","lines":["m"]},{"start":{"row":26,"column":16},"end":{"row":26,"column":17},"action":"insert","lines":["o"]},{"start":{"row":26,"column":17},"end":{"row":26,"column":18},"action":"insert","lines":["n"]},{"start":{"row":26,"column":18},"end":{"row":26,"column":19},"action":"insert","lines":["g"]},{"start":{"row":26,"column":19},"end":{"row":26,"column":20},"action":"insert","lines":["o"]},{"start":{"row":26,"column":20},"end":{"row":26,"column":21},"action":"insert","lines":["."]}],[{"start":{"row":26,"column":21},"end":{"row":26,"column":22},"action":"insert","lines":["d"],"id":1644},{"start":{"row":26,"column":22},"end":{"row":26,"column":23},"action":"insert","lines":["b"]},{"start":{"row":26,"column":23},"end":{"row":26,"column":24},"action":"insert","lines":["."]},{"start":{"row":26,"column":24},"end":{"row":26,"column":25},"action":"insert","lines":["u"]},{"start":{"row":26,"column":25},"end":{"row":26,"column":26},"action":"insert","lines":["s"]},{"start":{"row":26,"column":26},"end":{"row":26,"column":27},"action":"insert","lines":["e"]},{"start":{"row":26,"column":27},"end":{"row":26,"column":28},"action":"insert","lines":["r"]},{"start":{"row":26,"column":28},"end":{"row":26,"column":29},"action":"insert","lines":["s"]}],[{"start":{"row":39,"column":14},"end":{"row":39,"column":30},"action":"remove","lines":["users_collection"],"id":1645},{"start":{"row":39,"column":14},"end":{"row":39,"column":15},"action":"insert","lines":["m"]},{"start":{"row":39,"column":15},"end":{"row":39,"column":16},"action":"insert","lines":["o"]},{"start":{"row":39,"column":16},"end":{"row":39,"column":17},"action":"insert","lines":["n"]},{"start":{"row":39,"column":17},"end":{"row":39,"column":18},"action":"insert","lines":["d"]}],[{"start":{"row":39,"column":17},"end":{"row":39,"column":18},"action":"remove","lines":["d"],"id":1646}],[{"start":{"row":39,"column":17},"end":{"row":39,"column":18},"action":"insert","lines":["g"],"id":1647},{"start":{"row":39,"column":18},"end":{"row":39,"column":19},"action":"insert","lines":["o"]},{"start":{"row":39,"column":19},"end":{"row":39,"column":20},"action":"insert","lines":["."]},{"start":{"row":39,"column":20},"end":{"row":39,"column":21},"action":"insert","lines":["d"]},{"start":{"row":39,"column":21},"end":{"row":39,"column":22},"action":"insert","lines":["b"]}],[{"start":{"row":39,"column":22},"end":{"row":39,"column":23},"action":"insert","lines":["."],"id":1648},{"start":{"row":39,"column":23},"end":{"row":39,"column":24},"action":"insert","lines":["u"]},{"start":{"row":39,"column":24},"end":{"row":39,"column":25},"action":"insert","lines":["s"]},{"start":{"row":39,"column":25},"end":{"row":39,"column":26},"action":"insert","lines":["e"]},{"start":{"row":39,"column":26},"end":{"row":39,"column":27},"action":"insert","lines":["r"]},{"start":{"row":39,"column":27},"end":{"row":39,"column":28},"action":"insert","lines":["s"]}],[{"start":{"row":72,"column":10},"end":{"row":72,"column":26},"action":"remove","lines":["users_collection"],"id":1649},{"start":{"row":72,"column":10},"end":{"row":72,"column":11},"action":"insert","lines":["m"]},{"start":{"row":72,"column":11},"end":{"row":72,"column":12},"action":"insert","lines":["o"]},{"start":{"row":72,"column":12},"end":{"row":72,"column":13},"action":"insert","lines":["n"]},{"start":{"row":72,"column":13},"end":{"row":72,"column":14},"action":"insert","lines":["g"]},{"start":{"row":72,"column":14},"end":{"row":72,"column":15},"action":"insert","lines":["o"]},{"start":{"row":72,"column":15},"end":{"row":72,"column":16},"action":"insert","lines":["."]}],[{"start":{"row":72,"column":16},"end":{"row":72,"column":17},"action":"insert","lines":["d"],"id":1650},{"start":{"row":72,"column":17},"end":{"row":72,"column":18},"action":"insert","lines":["b"]},{"start":{"row":72,"column":18},"end":{"row":72,"column":19},"action":"insert","lines":["."]},{"start":{"row":72,"column":19},"end":{"row":72,"column":20},"action":"insert","lines":["u"]}],[{"start":{"row":72,"column":20},"end":{"row":72,"column":21},"action":"insert","lines":["s"],"id":1651},{"start":{"row":72,"column":21},"end":{"row":72,"column":22},"action":"insert","lines":["e"]},{"start":{"row":72,"column":22},"end":{"row":72,"column":23},"action":"insert","lines":["r"]},{"start":{"row":72,"column":23},"end":{"row":72,"column":24},"action":"insert","lines":["s"]}],[{"start":{"row":81,"column":4},"end":{"row":81,"column":20},"action":"remove","lines":["users_collection"],"id":1652},{"start":{"row":81,"column":4},"end":{"row":81,"column":5},"action":"insert","lines":["m"]},{"start":{"row":81,"column":5},"end":{"row":81,"column":6},"action":"insert","lines":["o"]},{"start":{"row":81,"column":6},"end":{"row":81,"column":7},"action":"insert","lines":["n"]},{"start":{"row":81,"column":7},"end":{"row":81,"column":8},"action":"insert","lines":["g"]},{"start":{"row":81,"column":8},"end":{"row":81,"column":9},"action":"insert","lines":["o"]}],[{"start":{"row":81,"column":9},"end":{"row":81,"column":10},"action":"insert","lines":["."],"id":1653},{"start":{"row":81,"column":10},"end":{"row":81,"column":11},"action":"insert","lines":["d"]},{"start":{"row":81,"column":11},"end":{"row":81,"column":12},"action":"insert","lines":["b"]}],[{"start":{"row":81,"column":12},"end":{"row":81,"column":13},"action":"insert","lines":["."],"id":1654},{"start":{"row":81,"column":13},"end":{"row":81,"column":14},"action":"insert","lines":["u"]},{"start":{"row":81,"column":14},"end":{"row":81,"column":15},"action":"insert","lines":["s"]},{"start":{"row":81,"column":15},"end":{"row":81,"column":16},"action":"insert","lines":["r"]},{"start":{"row":81,"column":16},"end":{"row":81,"column":17},"action":"insert","lines":["e"]}],[{"start":{"row":81,"column":16},"end":{"row":81,"column":17},"action":"remove","lines":["e"],"id":1655},{"start":{"row":81,"column":15},"end":{"row":81,"column":16},"action":"remove","lines":["r"]}],[{"start":{"row":81,"column":15},"end":{"row":81,"column":16},"action":"insert","lines":["e"],"id":1656},{"start":{"row":81,"column":16},"end":{"row":81,"column":17},"action":"insert","lines":["r"]},{"start":{"row":81,"column":17},"end":{"row":81,"column":18},"action":"insert","lines":["s"]}],[{"start":{"row":89,"column":17},"end":{"row":89,"column":33},"action":"remove","lines":["users_collection"],"id":1657},{"start":{"row":89,"column":17},"end":{"row":89,"column":18},"action":"insert","lines":["m"]},{"start":{"row":89,"column":18},"end":{"row":89,"column":19},"action":"insert","lines":["o"]},{"start":{"row":89,"column":19},"end":{"row":89,"column":20},"action":"insert","lines":["n"]},{"start":{"row":89,"column":20},"end":{"row":89,"column":21},"action":"insert","lines":["g"]},{"start":{"row":89,"column":21},"end":{"row":89,"column":22},"action":"insert","lines":["o"]},{"start":{"row":89,"column":22},"end":{"row":89,"column":23},"action":"insert","lines":["."]},{"start":{"row":89,"column":23},"end":{"row":89,"column":24},"action":"insert","lines":["d"]}],[{"start":{"row":89,"column":24},"end":{"row":89,"column":25},"action":"insert","lines":["b"],"id":1658},{"start":{"row":89,"column":25},"end":{"row":89,"column":26},"action":"insert","lines":["."]},{"start":{"row":89,"column":26},"end":{"row":89,"column":27},"action":"insert","lines":["u"]},{"start":{"row":89,"column":27},"end":{"row":89,"column":28},"action":"insert","lines":["s"]},{"start":{"row":89,"column":28},"end":{"row":89,"column":29},"action":"insert","lines":["e"]}],[{"start":{"row":89,"column":29},"end":{"row":89,"column":30},"action":"insert","lines":["f"],"id":1659},{"start":{"row":89,"column":30},"end":{"row":89,"column":31},"action":"insert","lines":["r"]},{"start":{"row":89,"column":31},"end":{"row":89,"column":32},"action":"insert","lines":["s"]}],[{"start":{"row":89,"column":31},"end":{"row":89,"column":32},"action":"remove","lines":["s"],"id":1660},{"start":{"row":89,"column":30},"end":{"row":89,"column":31},"action":"remove","lines":["r"]},{"start":{"row":89,"column":29},"end":{"row":89,"column":30},"action":"remove","lines":["f"]}],[{"start":{"row":89,"column":29},"end":{"row":89,"column":30},"action":"insert","lines":["r"],"id":1661},{"start":{"row":89,"column":30},"end":{"row":89,"column":31},"action":"insert","lines":["s"]}],[{"start":{"row":118,"column":15},"end":{"row":118,"column":31},"action":"remove","lines":["users_collection"],"id":1662},{"start":{"row":118,"column":15},"end":{"row":118,"column":16},"action":"insert","lines":["m"]},{"start":{"row":118,"column":16},"end":{"row":118,"column":17},"action":"insert","lines":["o"]},{"start":{"row":118,"column":17},"end":{"row":118,"column":18},"action":"insert","lines":["n"]},{"start":{"row":118,"column":18},"end":{"row":118,"column":19},"action":"insert","lines":["g"]},{"start":{"row":118,"column":19},"end":{"row":118,"column":20},"action":"insert","lines":["o"]},{"start":{"row":118,"column":20},"end":{"row":118,"column":21},"action":"insert","lines":["."]}],[{"start":{"row":118,"column":20},"end":{"row":118,"column":21},"action":"remove","lines":["."],"id":1663}],[{"start":{"row":118,"column":20},"end":{"row":118,"column":21},"action":"insert","lines":["d"],"id":1664},{"start":{"row":118,"column":21},"end":{"row":118,"column":22},"action":"insert","lines":["b"]},{"start":{"row":118,"column":22},"end":{"row":118,"column":23},"action":"insert","lines":["."]},{"start":{"row":118,"column":23},"end":{"row":118,"column":24},"action":"insert","lines":["u"]},{"start":{"row":118,"column":24},"end":{"row":118,"column":25},"action":"insert","lines":["s"]},{"start":{"row":118,"column":25},"end":{"row":118,"column":26},"action":"insert","lines":["s"]}],[{"start":{"row":118,"column":25},"end":{"row":118,"column":26},"action":"remove","lines":["s"],"id":1665}],[{"start":{"row":118,"column":25},"end":{"row":118,"column":26},"action":"insert","lines":["e"],"id":1666},{"start":{"row":118,"column":26},"end":{"row":118,"column":27},"action":"insert","lines":["r"]},{"start":{"row":118,"column":27},"end":{"row":118,"column":28},"action":"insert","lines":["s"]}],[{"start":{"row":118,"column":20},"end":{"row":118,"column":21},"action":"insert","lines":["."],"id":1667}],[{"start":{"row":143,"column":4},"end":{"row":143,"column":5},"action":"insert","lines":["m"],"id":1668},{"start":{"row":143,"column":5},"end":{"row":143,"column":6},"action":"insert","lines":["y"]}],[{"start":{"row":143,"column":5},"end":{"row":143,"column":6},"action":"remove","lines":["y"],"id":1669},{"start":{"row":143,"column":4},"end":{"row":143,"column":5},"action":"remove","lines":["m"]}],[{"start":{"row":143,"column":10},"end":{"row":143,"column":11},"action":"insert","lines":["s"],"id":1670},{"start":{"row":143,"column":11},"end":{"row":143,"column":12},"action":"insert","lines":["_"]},{"start":{"row":143,"column":12},"end":{"row":143,"column":13},"action":"insert","lines":["r"]},{"start":{"row":143,"column":13},"end":{"row":143,"column":14},"action":"insert","lines":["e"]},{"start":{"row":143,"column":14},"end":{"row":143,"column":15},"action":"insert","lines":["c"]},{"start":{"row":143,"column":15},"end":{"row":143,"column":16},"action":"insert","lines":["i"]},{"start":{"row":143,"column":16},"end":{"row":143,"column":17},"action":"insert","lines":["p"]},{"start":{"row":143,"column":17},"end":{"row":143,"column":18},"action":"insert","lines":["e"]}],[{"start":{"row":143,"column":11},"end":{"row":143,"column":12},"action":"remove","lines":["_"],"id":1671},{"start":{"row":143,"column":10},"end":{"row":143,"column":11},"action":"remove","lines":["s"]},{"start":{"row":143,"column":9},"end":{"row":143,"column":10},"action":"remove","lines":["e"]},{"start":{"row":143,"column":8},"end":{"row":143,"column":9},"action":"remove","lines":["p"]},{"start":{"row":143,"column":7},"end":{"row":143,"column":8},"action":"remove","lines":["i"]},{"start":{"row":143,"column":6},"end":{"row":143,"column":7},"action":"remove","lines":["c"]},{"start":{"row":143,"column":5},"end":{"row":143,"column":6},"action":"remove","lines":["e"]},{"start":{"row":143,"column":4},"end":{"row":143,"column":5},"action":"remove","lines":["r"]}],[{"start":{"row":2,"column":77},"end":{"row":2,"column":78},"action":"insert","lines":[","],"id":1672}],[{"start":{"row":2,"column":78},"end":{"row":2,"column":79},"action":"insert","lines":[" "],"id":1673},{"start":{"row":2,"column":79},"end":{"row":2,"column":80},"action":"insert","lines":["f"]},{"start":{"row":2,"column":80},"end":{"row":2,"column":81},"action":"insert","lines":["l"]},{"start":{"row":2,"column":81},"end":{"row":2,"column":82},"action":"insert","lines":["a"]},{"start":{"row":2,"column":82},"end":{"row":2,"column":83},"action":"insert","lines":["s"]},{"start":{"row":2,"column":83},"end":{"row":2,"column":84},"action":"insert","lines":["h"]}],[{"start":{"row":149,"column":79},"end":{"row":149,"column":80},"action":"remove","lines":["s"],"id":1674}],[{"start":{"row":149,"column":79},"end":{"row":149,"column":80},"action":"insert","lines":["s"],"id":1675}],[{"start":{"row":21,"column":0},"end":{"row":122,"column":35},"action":"remove","lines":["# Login","@app.route('/login', methods=['GET'])","def login():","\t# Check if user is not logged in already","\tif 'user' in session:","\t\tuser_in_db = mongo.db.users.find_one({\"username\": session['user']})","\t\tif user_in_db:","\t\t\t# If so redirect user to his profile","\t\t\tflash(\"You are logged in already!\")","\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\telse:","\t\t# Render the page for user to be able to log in","\t\treturn render_template(\"login.html\")","\t\t","# Check user login details from login form","@app.route('/user_auth', methods=['POST'])","def user_auth():","\tform = request.form.to_dict()","\tuser_in_db = mongo.db.users.find_one({\"username\": form['username']})","\t# Check for user in database","\tif user_in_db:","\t\t# If passwords match (hashed / real password)","\t\tif check_password_hash(user_in_db['password'], form['user_password']):","\t\t\t# Log user in (add to session)","\t\t\tsession['user'] = form['username']","\t\t\t# If the user is admin redirect him to admin area","\t\t\tif session['user'] == \"admin\":","\t\t\t\treturn redirect(url_for('admin'))","\t\t\telse:","\t\t\t\tflash(\"You were logged in!\")","\t\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\t\t\t","\t\telse:","\t\t\tflash(\"Wrong password or user name!\")","\t\t\treturn redirect(url_for('login'))","\telse:","\t\tflash(\"You must be registered!\")","\t\treturn redirect(url_for('register'))","\t\t","# Sign up","@app.route('/register', methods=['GET', 'POST'])","def register():","\t# Check if user is not logged in already","\tif 'user' in session:","\t\tflash('You are already sign in!')","\t\treturn redirect(url_for('index'))","\tif request.method == 'POST':","\t\tform = request.form.to_dict()","\t\t# Check if the password and password1 actualy match ","\t\tif form['user_password'] == form['user_password1']:","\t\t\t# If so try to find the user in db","\t\t\tuser = mongo.db.users.find_one({\"username\" : form['username']})","\t\t\tif user:","\t\t\t\tflash(f\"{form['username']} already exists!\")","\t\t\t\treturn redirect(url_for('register'))","\t\t\t# If user does not exist register new user","\t\t\telse:\t\t\t\t","\t\t\t\t# Hash password","\t\t\t\thash_pass = generate_password_hash(form['user_password'])","\t\t\t\t#Create new user with hashed password","\t\t\t\tmongo.db.users.insert_one(","\t\t\t\t\t{","\t\t\t\t\t\t'username': form['username'],","\t\t\t\t\t\t'email': form['email'],","\t\t\t\t\t\t'password': hash_pass","\t\t\t\t\t}","\t\t\t\t)","\t\t\t\t# Check if user is actualy saved","\t\t\t\tuser_in_db = mongo.db.users.find_one({\"username\": form['username']})","\t\t\t\tif user_in_db:","\t\t\t\t\t# Log user in (add to session)","\t\t\t\t\tsession['user'] = user_in_db['username']","\t\t\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\t\t\t\telse:","\t\t\t\t\tflash(\"There was a problem savaing your profile\")","\t\t\t\t\treturn redirect(url_for('register'))","","\t\telse:","\t\t\tflash(\"Passwords dont match!\")","\t\t\treturn redirect(url_for('register'))","\t\t","\treturn render_template(\"register.html\")","\t","# Log out","@app.route('/logout')","def logout():","\t# Clear the session","\tsession.clear()","\tflash('You were logged out!')","\treturn redirect(url_for('index'))","\t","# Profile Page","@app.route('/profile/<user>')","def profile(user): ","\t# Check if user is logged in","\tif 'user' in session:","\t\t# If so get the user and pass him to template for now","\t\tuser_in_db = mongo.db.users.find_one({\"username\": user})","\t\treturn render_template('profile.html', user=user_in_db)","\telse:","\t\tflash(\"You must be logged in!\")","\t\treturn redirect(url_for('index'))"],"id":1676}],[{"start":{"row":20,"column":0},"end":{"row":21,"column":0},"action":"remove","lines":["",""],"id":1677}],[{"start":{"row":20,"column":0},"end":{"row":21,"column":4},"action":"remove","lines":["","    "],"id":1678},{"start":{"row":19,"column":40},"end":{"row":20,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":19,"column":40},"end":{"row":20,"column":0},"action":"insert","lines":["",""],"id":1679},{"start":{"row":20,"column":0},"end":{"row":20,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":51,"column":61},"end":{"row":51,"column":67},"action":"remove","lines":["      "],"id":1680},{"start":{"row":51,"column":61},"end":{"row":52,"column":0},"action":"insert","lines":["",""]},{"start":{"row":52,"column":0},"end":{"row":52,"column":4},"action":"insert","lines":["    "]},{"start":{"row":52,"column":4},"end":{"row":53,"column":0},"action":"insert","lines":["",""]},{"start":{"row":53,"column":0},"end":{"row":53,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":53,"column":4},"end":{"row":154,"column":35},"action":"insert","lines":["# Login","@app.route('/login', methods=['GET'])","def login():","\t# Check if user is not logged in already","\tif 'user' in session:","\t\tuser_in_db = mongo.db.users.find_one({\"username\": session['user']})","\t\tif user_in_db:","\t\t\t# If so redirect user to his profile","\t\t\tflash(\"You are logged in already!\")","\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\telse:","\t\t# Render the page for user to be able to log in","\t\treturn render_template(\"login.html\")","\t\t","# Check user login details from login form","@app.route('/user_auth', methods=['POST'])","def user_auth():","\tform = request.form.to_dict()","\tuser_in_db = mongo.db.users.find_one({\"username\": form['username']})","\t# Check for user in database","\tif user_in_db:","\t\t# If passwords match (hashed / real password)","\t\tif check_password_hash(user_in_db['password'], form['user_password']):","\t\t\t# Log user in (add to session)","\t\t\tsession['user'] = form['username']","\t\t\t# If the user is admin redirect him to admin area","\t\t\tif session['user'] == \"admin\":","\t\t\t\treturn redirect(url_for('admin'))","\t\t\telse:","\t\t\t\tflash(\"You were logged in!\")","\t\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\t\t\t","\t\telse:","\t\t\tflash(\"Wrong password or user name!\")","\t\t\treturn redirect(url_for('login'))","\telse:","\t\tflash(\"You must be registered!\")","\t\treturn redirect(url_for('register'))","\t\t","# Sign up","@app.route('/register', methods=['GET', 'POST'])","def register():","\t# Check if user is not logged in already","\tif 'user' in session:","\t\tflash('You are already sign in!')","\t\treturn redirect(url_for('index'))","\tif request.method == 'POST':","\t\tform = request.form.to_dict()","\t\t# Check if the password and password1 actualy match ","\t\tif form['user_password'] == form['user_password1']:","\t\t\t# If so try to find the user in db","\t\t\tuser = mongo.db.users.find_one({\"username\" : form['username']})","\t\t\tif user:","\t\t\t\tflash(f\"{form['username']} already exists!\")","\t\t\t\treturn redirect(url_for('register'))","\t\t\t# If user does not exist register new user","\t\t\telse:\t\t\t\t","\t\t\t\t# Hash password","\t\t\t\thash_pass = generate_password_hash(form['user_password'])","\t\t\t\t#Create new user with hashed password","\t\t\t\tmongo.db.users.insert_one(","\t\t\t\t\t{","\t\t\t\t\t\t'username': form['username'],","\t\t\t\t\t\t'email': form['email'],","\t\t\t\t\t\t'password': hash_pass","\t\t\t\t\t}","\t\t\t\t)","\t\t\t\t# Check if user is actualy saved","\t\t\t\tuser_in_db = mongo.db.users.find_one({\"username\": form['username']})","\t\t\t\tif user_in_db:","\t\t\t\t\t# Log user in (add to session)","\t\t\t\t\tsession['user'] = user_in_db['username']","\t\t\t\t\treturn redirect(url_for('profile', user=user_in_db['username']))","\t\t\t\telse:","\t\t\t\t\tflash(\"There was a problem savaing your profile\")","\t\t\t\t\treturn redirect(url_for('register'))","","\t\telse:","\t\t\tflash(\"Passwords dont match!\")","\t\t\treturn redirect(url_for('register'))","\t\t","\treturn render_template(\"register.html\")","\t","# Log out","@app.route('/logout')","def logout():","\t# Clear the session","\tsession.clear()","\tflash('You were logged out!')","\treturn redirect(url_for('index'))","\t","# Profile Page","@app.route('/profile/<user>')","def profile(user): ","\t# Check if user is logged in","\tif 'user' in session:","\t\t# If so get the user and pass him to template for now","\t\tuser_in_db = mongo.db.users.find_one({\"username\": user})","\t\treturn render_template('profile.html', user=user_in_db)","\telse:","\t\tflash(\"You must be logged in!\")","\t\treturn redirect(url_for('index'))"],"id":1681}]]},"ace":{"folds":[],"scrolltop":1575.5,"scrollleft":0,"selection":{"start":{"row":154,"column":35},"end":{"row":154,"column":35},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":25,"state":"start","mode":"ace/mode/python"}},"timestamp":1579352659615,"hash":"a467e0b5f26c0346af6f6cfafd037a2b79ed74f4"}